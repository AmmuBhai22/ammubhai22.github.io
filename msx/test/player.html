<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resumable HLS.js Video Player</title>
    <script src="https://ammubhai22-github-io.pages.dev/msx/test/hls.js"></script>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            overflow: hidden;
        }

        #videoPlayer {
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body>

<video id="videoPlayer" autoplay>
    Your browser does not support the video tag.
</video>

<script>
    var video = document.getElementById('videoPlayer');
    var hls = new Hls();

    // Replace 'your_file.m3u8' with the actual path or URL of your HLS stream
    var videoSrc = 'http://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8';

    if (Hls.isSupported()) {
        hls.loadSource(videoSrc);
        hls.attachMedia(video);

        video.addEventListener('timeupdate', function() {
            // Store the current playback position in local storage
            localStorage.setItem('lastPlaybackPosition', video.currentTime.toFixed(2));
        });

        setInterval(function () {
            // Check if there's a stored playback position and set it
            var storedPosition = localStorage.getItem('lastPlaybackPosition');
            if (storedPosition) {
                video.currentTime = parseFloat(storedPosition);
            }

            // Log the refresh time in the console
            console.log('Refreshed at:', video.currentTime.toFixed(2));

            // Reload the source
            hls.startLoad();

            // Play the video
            video.play();
        }, 5000);

        // Play/pause, rewind, and navigation event listeners
        document.addEventListener('keydown', function (event) {
            switch (event.keyCode) {
                case 19: // Play/pause (Pause/Break key)
                case 13: // Play/pause (Enter key)
                case 415: // Play/pause (Media Play key)
                    video.paused ? video.play() : video.pause();
                    break;
                case 39: // Rewind 5 sec forward (Right Arrow key)
                case 417: // Rewind 5 sec forward (Media Fast Forward key)
                    video.currentTime += 5;
                    video.controls = true; // Show controls when rewinding
                    break;
                case 37: // Rewind 5 sec backward (Left Arrow key)
                case 412: // Rewind 5 sec backward (Media Rewind key)
                    video.currentTime -= 5;
                    video.controls = true; // Show controls when rewinding
                    break;
                case 413: // Back to previous site (Media Stop key)
                    window.history.back();
                    break;
                default:
                    break;
            }
        });

        // Listen to the playing event to hide controls dynamically
        video.addEventListener('playing', function () {
            video.controls = false;
        });

    } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
        video.src = videoSrc;
        video.play();

        // Listen to the playing event to hide controls dynamically
        video.addEventListener('playing', function () {
            video.controls = false;
        });
    }
</script>

</body>
</html>